pipeline {
agent any
stages {
   stage('Pipeline-Config'){
   steps{
      withVault(configuration: [vaultGlobal: 'e697b6f6-db61-4dd3-97f0-6cb668d7ec51', vaultUrl: 'https://hcvdev.fiscloudservices.com'], vaultSecrets: [[engineVersion: 2, path: '/vi/auth/approle/teller_user_role/login', secretValues: [[envVar: 'username', vaultKey: 'user']]]]) 
	  {
           sh "echo $user"
       }
	   
	   }
    }
  }

https://medium.com/geekculture/integrate-hashicorp-vault-with-cicd-tool-jenkins-4bf712ad3f45


}



 Started by upstream project "IdP/NB-Deployments/Deployment_Dynascan_Oracle_IdP_Plain_NB_Admin2" build number 976
 originally caused by:
  Started by upstream project "IdP/NB-Deployments/Deployment_Dynascan_Oracle_IdP_Plain_NB_Admin" build number 981
  originally caused by:
   Started by upstream project "IdP/OnDemand-Deployment/bitbucket-clone-with-jenkins" build number 1115
   originally caused by:
    Started by upstream project "IdP/Build/Trunk-NightBuild" build number 1220
    originally caused by:
     Started by timer
     Started by user Kirti Jeurkar (e1077363)
     Started by upstream project "IdP/Build/Trunk-NightBuild" build number 1219
     originally caused by:
      Started by timer
 Running as SYSTEM
 [EnvInject] - Loading node environment variables.
 Building remotely on vlmazxidpbuild01.fisdev.local (IdPbuild-Dev-QA) in workspace /data/workspace/workspace/IdP/NB-Deployments/Deployment_Dynascan_Oracle_IdP_Plain_NB_DH
 [EnvInject] - Executing scripts and injecting environment variables after the SCM step.
 [EnvInject] - Injecting as environment variables the properties content 
 ANT_OPTS="-Djdk.util.jar.enableMultiRelease=force"
 
 [EnvInject] - Variables injected successfully.
 [Deployment_Dynascan_Oracle_IdP_Plain_NB_DH] $ /bin/sh -xe /tmp/jenkins7613768205157773236.sh
 + ssh -o StrictHostKeyChecking=no svc-idpnb@10.7.185.167 '. .bash_profile; sh -x /data/workspace/build.scripts/nightlybuild_scripts/deploy_az/tomcat_dynascan/remoteScript_TmMysql_dh.sh 1220 5.8.0 IdPRI Install; sleep 60'
 *******************************************************************************
 **                                                                           **
 **  SECURITY NOTICE:                                                         **
 **  This computer system contains sensitive client information managed by    **
 **  FIS and is intended for official and other authorized use only.          **
 **  Unauthorized access or use of this system may subject violators to       **
 **  administrative action, civil, and/or criminal prosecution under the      **
 **  United States Criminal Code (Title 18 U.S.C. \247 1030).                 **
 **  All information on this computer system may be monitored, intercepted,   **
 **  recorded, read, copied, or captured and disclosed by and to authorized   **
 **  personnel for official purposes, including criminal prosecution.         **
 **  You have no expectations of privacy using this system. Any authorized    **
 **  or unauthorized use of this computer system signifies consent to and     **
 **  compliance with FIS policies and those security/privacy compliance       **
 **  regulations required by external governing bodies and these terms.       **
 **                                                                           **
 **  By logging into this server, you agree to accept these terms.            **
 *******************************************************************************
 + TOMCAT_HOME=/data/tomcat_idp_dh
 + CONTEXTDIR=/data/tomcat_idp_dh/webapps/dynascan
 + ANTPATH=/data/tomcat_idp_dh/webapps/dynascan/WEB-INF/dbsetup
 + BUILD_NO=1220
 + REL=5.8.0
 + JAVA_HOME=/data/java
 + WAR_FILE_TYPE=IdPRI
 + BACKUP_PATH=/data/tomcat_idp_dh/logs
 + WAR_FILE=IdPRI-1220-5.8.0.war
 + ANT=/data/ant/bin/ant
 + SCRIPT_HOME=/data/workspace
 + Property_File=/data/workspace/build.scripts/nightlybuild_scripts/deploy_az/tomcat_dynascan/idp-dynascan_dh-input.properties
 + JAR=/data/java/bin/jar
 + CSA_CONFIG_FILE=CSA.properties
 + PROP_PATH=/data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props
 + SOURCE_IP=147.249.226.11
 + DEST_IP=10.247.97.13
 + SOURCE_MAIL_ADD=csa.techsupport@sungard.com
 + DEST_MAIL_ADD=no-reply@sungard.com
 + JMX_PORT=1111
 + NEW_JMX_PORT=1106
 /data/tomcat_idp_dh/webapps/dynascan exists
 + '[' -d /data/tomcat_idp_dh/webapps/dynascan ']'
 + echo '/data/tomcat_idp_dh/webapps/dynascan exists'
 + TOMCAT_STOP
 + sudo /etc/init.d/dynascan_dh stop
 Stopping Tomcat
 $CATALINA_PID was set but the specified file does not exist. Is Tomcat running? Stop aborted.
 + WAR_Clean
 + cd /data/tomcat_idp_dh
 + rm -rf logs/applyPatch.log logs/catalina.2024-08-28.log logs/catalina.2024-08-29.log logs/catalina.out logs/host-manager.2024-08-28.log logs/localhost.2024-08-28.log logs/localhost.2024-08-29.log logs/localhost_access_log..2024-08-28.txt logs/localhost_access_log..2024-08-29.txt logs/manager.2024-08-28.log work/Catalina temp/jr-font6797598857148169801.ttf temp/jr-font8545168036717774944.ttf
 + rm -rf /data/tomcat_idp_dh/webapps/dynascan/apple-touch-icon-114x114-precomposed.png /data/tomcat_idp_dh/webapps/dynascan/apple-touch-icon-57x57-precomposed.png /data/tomcat_idp_dh/webapps/dynascan/apple-touch-icon-72x72-precomposed.png /data/tomcat_idp_dh/webapps/dynascan/apple-touch-icon.png /data/tomcat_idp_dh/webapps/dynascan/apple-touch-icon-precomposed.png /data/tomcat_idp_dh/webapps/dynascan/csa /data/tomcat_idp_dh/webapps/dynascan/favicon.ico /data/tomcat_idp_dh/webapps/dynascan/files /data/tomcat_idp_dh/webapps/dynascan/helpcontent /data/tomcat_idp_dh/webapps/dynascan/importFile /data/tomcat_idp_dh/webapps/dynascan/jsd /data/tomcat_idp_dh/webapps/dynascan/jsp /data/tomcat_idp_dh/webapps/dynascan/META-INF /data/tomcat_idp_dh/webapps/dynascan/report /data/tomcat_idp_dh/webapps/dynascan/resources /data/tomcat_idp_dh/webapps/dynascan/robots.txt /data/tomcat_idp_dh/webapps/dynascan/sso /data/tomcat_idp_dh/webapps/dynascan/static-ui /data/tomcat_idp_dh/webapps/dynascan/temporaryFiles /data/tomcat_idp_dh/webapps/dynascan/tempthemes /data/tomcat_idp_dh/webapps/dynascan/themes /data/tomcat_idp_dh/webapps/dynascan/WEB-INF /data/tomcat_idp_dh/webapps/dynascan/wsdl
 + WAR_Download
 + cd /data/tomcat_idp_dh/webapps/dynascan
 + wget -nv http://10.7.185.172//buildrepository/CSA/nightbuild/trunk/1220/IdPRI-1220-5.8.0.war
 2024-08-29 00:43:16 URL:http://10.7.185.172//buildrepository/CSA/nightbuild/trunk/1220/IdPRI-1220-5.8.0.war [263973023/263973023] -> "IdPRI-1220-5.8.0.war" [1]
 WAR Download successful
 + '[' 0 -eq 0 ']'
 + echo 'WAR Download successful'
 + /data/java/bin/jar -xf IdPRI-1220-5.8.0.war
 + rm -rf IdPRI-1220-5.8.0.war
 Copy com Directory
 + echo 'Copy com Directory'
 + cp -R /build.scripts/nightlybuild_scripts/deploy_az/com /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/
 cp: cannot stat ‘/build.scripts/nightlybuild_scripts/deploy_az/com’: No such file or directory
 + WAR_Prepare
 + cd /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/dbsetup
 + /data/ant/bin/ant -f build.xml -propertyfile /data/workspace/build.scripts/nightlybuild_scripts/deploy_az/tomcat_dynascan/idp-dynascan_dh-input.properties
 + tee -a /data/tomcat_idp_dh/logs/applyPatch.log
 Buildfile: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/dbsetup/build.xml
 
 newiafdb:
 
 displaypathnote:
      [echo] *************************************************************************************
      [echo] ** NOTE: Please use '/'(FORWARD SLASH) as path separator while providing the input **
      [echo] *************************************************************************************
 
 broadcastprompt:
     [input] skipping input as property clusterEnvironment has already been set.
     [input] skipping input as property httpInvokerClusterHosts has already been set.
     [input] skipping input as property setup.new.db has already been set.
 
 dbtypeprompt:
     [input] skipping input as property db.type has already been set.
     [input] skipping input as property db.ssl has already been set.
 
 newdbprompt:
     [input] skipping input as property db.create.new has already been set.
     [input] skipping input as property db.create.tables has already been set.
 
 targetprompt:
     [input] skipping input as property target.version has already been set.
     [input] skipping input as property merge.generate.target.schema.file has already been set.
 
 getinput:
 
 dbhostprompt:
     [input] skipping input as property db.host has already been set.
     [input] skipping input as property db.port has already been set.
     [input] skipping input as property db.schema.name has already been set.
     [input] skipping input as property db.schema.password has already been set.
     [input] skipping input as property db.service.name has already been set.
     [input] skipping input as property load.static.data has already been set.
     [input] skipping input as property load.dynamic.data has already been set.
     [input] skipping input as property guid.generation.type has already been set.
 
 write.csa.build.properties:
 [propertyfile] Creating new property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/csa.build.properties
    [delete] Deleting: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/dbsetup/temp/pass.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/csa.build.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/csa.build.properties
 [propertyfile] Creating new property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/database.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/database.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props/GUIDConfig.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/ExternalEventProcessor.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/csa.build.properties
    [delete] Deleting: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/dbsetup/temp/pass.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/csa.build.properties
 [propertyfile] Updating property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/database.properties
 
 persistdbsetupproperties:
 [propertyfile] Creating new property file: /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/csa.dbsetup.properties
      [echo] Executing newdb
 [DatabaseEngine] Executing DatabaseEngine Task : newiafdb
 [DatabaseEngine] Merging DB Schema in file /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/META-INF/dbsetup/active/db_.xml
 [DatabaseEngine] Setting up new database for version : active started.
 [DatabaseEngine] Creating table metadata from file : /META-INF/dbsetup/active/db_.xml
 [DatabaseEngine] Setting up new database for version : active complete.
 
 cleaniodirectory:
    [delete] Deleting directory /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/dbsetup/temp
 
 BUILD SUCCESSFUL
 Total time: 2 seconds
 + cd /data/tomcat_idp_dh/webapps/dynascan
 + sed -i 's/remote.isi_services.url=http:\/\/localhost:8080\/ISI/remote.isi_services.url=http:\/\/10.7.185.176:8001\/ISI_QA/g' WEB-INF/classes/config/props/CSA.properties
 + sed -i 's/remote.geo_service.url=http:\/\/localhost:8090\/geo/remote.geo_service.url=http:\/\/10.7.185.176:8004\/geo/g' WEB-INF/classes/config/props/MSA.properties
 + sed -i s/captcha.test.code=/captcha.test.code=abcd/g /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props/CSA.dynamic.properties
 + cp -r '/data/tomcat_idp_dh/temp/test/*' /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes
 cp: cannot stat ‘/data/tomcat_idp_dh/temp/test/*’: No such file or directory
 + mkdir -p /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/log
 + ln -s /data/nfs /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/logs
 + ln -s /data/nfs/importFile/ /data/tomcat_idp_dh/webapps/dynascan/importFile
 + ln -s /data/nfs/messagelogger /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/log/messagelogger
 + GlobalSearch
 + PROP_PATH=/data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props
 + GS_File=/data/workspace/build.scripts/nightlybuild_scripts/deploy_az/GlobalSearchConfig.txt
 + for parameter in collection password user
 + [[ collection == \c\o\l\l\e\c\t\i\o\n ]]
 ++ cat /data/workspace/build.scripts/nightlybuild_scripts/deploy_az/GlobalSearchConfig.txt
 ++ grep dyna
 ++ awk -F ' ' '{print $NF}'
 + value=idpmetadyna
 + sed -i '/^search.provider.collection/ s|=.*|=idpmetadyna|g' /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props/CSA.dynamic.properties
 + sed -i '/^search.provider.user/ s|=.*|=idpmetadyna|g' /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props/CSA.dynamic.properties
 + for parameter in collection password user
 + [[ password == \c\o\l\l\e\c\t\i\o\n ]]
 + [[ password == \p\a\s\s\w\o\r\d ]]
 ++ cat /data/workspace/build.scripts/nightlybuild_scripts/deploy_az/GlobalSearchConfig.txt
 ++ grep -A1 dyna
 ++ grep -v dyna
 ++ awk -F d= '{print $NF}'
 + value='ENC(Xy5fa3v7OTEnKj3iFZfo6U5LbV5Z0EPngjI9vo3TiAQbyOorAH3Qqw==)'
 + sed -i '/^search.provider.password/ s|=.*|=ENC(Xy5fa3v7OTEnKj3iFZfo6U5LbV5Z0EPngjI9vo3TiAQbyOorAH3Qqw==)|g' /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props/CSA.dynamic.properties
 + for parameter in collection password user
 + [[ user == \c\o\l\l\e\c\t\i\o\n ]]
 + [[ user == \p\a\s\s\w\o\r\d ]]
 + sed -i '/^search.enabled/ s|=.*|=true|g' /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props/CSA.dynamic.properties
 + sed -i '/^search.provider.url/ s|localhost|10.7.185.167|g' /data/tomcat_idp_dh/webapps/dynascan/WEB-INF/classes/config/props/CSA.dynamic.properties
 + TOMCAT_START
 + sudo /etc/init.d/dynascan_dh start
 Starting tomcat: 
 Tomcat started.
 INFO: Tomcat started
 Triggering a new build of IdP » NB-Deployments » Deployment_Dynascan_Oracle_IdP_Plain_NB_login1
 Finished: SUCCESS
