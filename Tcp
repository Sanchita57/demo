pipeline {
agent any
stages {
   stage('Pipeline-Config'){
   steps{
      withVault(configuration: [vaultGlobal: 'e697b6f6-db61-4dd3-97f0-6cb668d7ec51', vaultUrl: 'https://hcvdev.fiscloudservices.com'], vaultSecrets: [[engineVersion: 2, path: '/vi/auth/approle/teller_user_role/login', secretValues: [[envVar: 'username', vaultKey: 'user']]]]) 
	  {
           sh "echo $user"
       }
	   
	   }
    }
  }

https://medium.com/geekculture/integrate-hashicorp-vault-with-cicd-tool-jenkins-4bf712ad3f45


}



Loading library jenkins-pipeline-deploy-library@master
Attempting to resolve master from remote references...
 > git --version # timeout=30
 > git --version # 'git version 2.22.0'
using GIT_ASKPASS to set credentials cm-credentials-id credentials
 > git ls-remote -h -- https://bam-build@bitbucket.fis.dev/scm/jdm/deploylib.git # timeout=30
Found match: refs/heads/master revision fc5a28192de714d5c218faf4ff7ff1332c0b4a92
The recommended git tool is: NONE
using credential cm-credentials-id
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop@libs/f5e7f94a0feb41ae0e1f84d6c66d27b24ef0af5bf59db11cdacebd1b167ff23d/.git # timeout=30
Fetching changes from the remote Git repository
 > git config remote.origin.url https://bam-build@bitbucket.fis.dev/scm/jdm/deploylib.git # timeout=30
Fetching without tags
Fetching upstream changes from https://bam-build@bitbucket.fis.dev/scm/jdm/deploylib.git
 > git --version # timeout=30
 > git --version # 'git version 2.22.0'
using GIT_ASKPASS to set credentials cm-credentials-id credentials
 > git fetch --no-tags --force --progress -- https://bam-build@bitbucket.fis.dev/scm/jdm/deploylib.git +refs/heads/*:refs/remotes/origin/* # timeout=30
Checking out Revision fc5a28192de714d5c218faf4ff7ff1332c0b4a92 (master)
 > git config core.sparsecheckout # timeout=30
 > git checkout -f fc5a28192de714d5c218faf4ff7ff1332c0b4a92 # timeout=30
Commit message: "test email"
[Pipeline] Start of Pipeline
[Pipeline] node
Running on bnk-jdk-slave2-d8a9f06b in /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop
[Pipeline] {
[Pipeline] stage
[Pipeline] { (deploy)
[Pipeline] sshagent
[ssh-agent] Using credentials jenkins
[ssh-agent] Looking for ssh-agent implementation...
[ssh-agent]   Exec ssh-agent (binary ssh-agent on a remote machine)
$ ssh-agent
SSH_AUTH_SOCK=/tmp/ssh-jhiNGsTVfECC/agent.16380
SSH_AGENT_PID=16382
Running ssh-add (command line suppressed)
Identity added: /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop@tmp/private_key_31893338861130701.key (/home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop@tmp/private_key_31893338861130701.key)
[ssh-agent] Started.
[Pipeline] {
[Pipeline] sh
+ rm -rf /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/application_data /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_application_control_files /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_deploy_migrate_scripts /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_deploy_migrate_scripts@tmp
[Pipeline] dir
Running in /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_deploy_migrate_scripts
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] sh
Warning: A secret was passed to "sh" using Groovy String interpolation, which is insecure.
		 Affected argument(s) used the following variable(s): [PASSWORD, USERNAME]
		 See https://jenkins.io/redirect/groovy-string-interpolation for details.
+ curl --user ****:**** -s -k -f -o jenkins_deploy_migrate_scripts.zip https://artifactory.fis.dev/artifactory/harvest-maven-snapshot-local/Jenkins_deploy_migrate_scripts/jenkins_deploy_migrate_scripts/0.1.0-SNAPSHOT/jenkins_deploy_migrate_scripts-0.1.0-SNAPSHOT.zip
[Pipeline] sh
+ unzip -q jenkins_deploy_migrate_scripts.zip
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // dir
[Pipeline] dir
Running in /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_deploy_migrate_scripts/src
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] sh
Warning: A secret was passed to "sh" using Groovy String interpolation, which is insecure.
		 Affected argument(s) used the following variable(s): [PASSWORD, USERNAME]
		 See https://jenkins.io/redirect/groovy-string-interpolation for details.
+ /usr/bin/perl deploy_migrate_001_bnk_IBS_Jboss.pl **** ****
----------------------------------------------------------------------------
---
--- JOB INPUTS
---
----------------------------------------------------------------------------

job_name                   is:IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop
artifactory_version_number is:2.0.Mod-SNAPSHOT
ticket_number              is:
execute_type               is:execute
ws_operation               is:
jb_operation               is:bounce
app_group                  is:IBSSRM
env                        is:Development
deploy_type                is:JBoss
app_name                   is:DevSys_SRM_Desktop
ini_name                   is:IBSSRM-Development-JBoss-DevSys_SRM_Desktop
----------------------------------------------------------------------------
---
--- Extract application control files from Artifactory
---
----------------------------------------------------------------------------

--- cmd is:curl --user ****:**** -s -k -f -o /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_application_control_files/IBSSRM.zip https://artifactory.fis.dev/artifactory/harvest-maven-snapshot-local/Jenkins_application_control_files/IBSSRM/0.1.0-SNAPSHOT/IBSSRM-0.1.0-SNAPSHOT.zip
----------------------------------------------------------------------------
---
--- Unzip application control files
---
----------------------------------------------------------------------------

--- cmd is:unzip -q /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_application_control_files/IBSSRM.zip -d /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_application_control_files
----------------------------------------------------------------------------
---
--- Read jboss application control file:/home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_application_control_files/src/IBSSRM-Development-deploy-DevSys_SRM_Desktop.ini
---
----------------------------------------------------------------------------

artifactory_path       is: https://artifactory.fis.dev/artifactory/ibssrm-maven-snapshot-local/com/fis/IBS/srm/mod
artifactory_filename   is: opstopsrm
artifactory_filetype   is: ear
artifactory_classifier is: 
jboss_app_name         is: MD_Desktop_SRM_Dev_Sys
jboss_server           is: vlmazibsdm.fisdev.local
jboss_node_name        is: MD_Desktop_SRM_Dev_Sys
jboss_cmd_dir          is: /tmp/test/
jboss_cmd              is: 
jboss_war_dir          is: /tmp/test
jboss_unzip_dir        is: /tmp/test
jboss_log_file         is: 
jboss_admin_user       is: jbadmin
----------------------------------------------------------------------------
---
--- Execute jboss bounce
---
----------------------------------------------------------------------------

----------------------------------------------------------------------------
---
--- Copy bounce script:ibs_jboss_wrapper.pl to:/tmp/test/
---
----------------------------------------------------------------------------

--- cmd is:/bin/scp -q -o StrictHostKeyChecking=no /home/jenkins/workspace/IBSSRM-Development/IBSSRM-Development-JBoss-DevSys_SRM_Desktop/jenkins_deploy_migrate_scripts/src/ibs_jboss_wrapper.pl jbadmin@vlmazibsdm.fisdev.local:/tmp/test/
----------------------------------------------------------------------------
---
--- set permissions on bounce script /tmp/test//ibs_jboss_wrapper.pl
---
----------------------------------------------------------------------------

--- cmd is:/bin/ssh -q -o StrictHostKeyChecking=no jbadmin@vlmazibsdm.fisdev.local chmod 755 /tmp/test//ibs_jboss_wrapper.pl
----------------------------------------------------------------------------
---
--- Execute bounce script:/tmp/test//ibs_jboss_wrapper.pl
---
----------------------------------------------------------------------------

--- cmd is:/bin/ssh -q -o StrictHostKeyChecking=no jbadmin@vlmazibsdm.fisdev.local perl /tmp/test//ibs_jboss_wrapper.pl bounce /opt/JbossEAP/7.4/jboss-eap-7.4_DevSys /opt/JbossEAP/7.4/java_11/java-11-openjdk-11.0.14.1.1-1.portable.jre.el.x86_64 /opt/JbossEAP/7.4/jboss-eap-7.4_DevSys/bin --connect --controller=vlmazibsdm.fisdev.local:9980 MD_Desktop_SRM_Dev_Sys jboss-cli.sh /tmp/test/ opstopsrm vlmazibsdm.fisdev.local MD_Desktop_SRM_Dev_Sys
JAVA_HOME    is: /opt/JbossEAP/7.4/java_11/java-11-openjdk-11.0.14.1.1-1.portable.jre.el.x86_64
JBOSS_HOME   is: /opt/JbossEAP/7.4/jboss-eap-7.4_DevSys
current working directory is:/opt/JbossEAP/7.4/jboss-eap-7.4_DevSys/bin
$pwuid = jbadmin
{
    "outcome" => "success",
    "result" => undefined,
    "server-groups" => undefined
}
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
$ ssh-agent -k
unset SSH_AUTH_SOCK;
unset SSH_AGENT_PID;
echo Agent pid 16382 killed;
[ssh-agent] Stopped.
[Pipeline] // sshagent
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
